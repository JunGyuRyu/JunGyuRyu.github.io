<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>
<%@page import="java.sql.DriverManager"%>
<%@ page language="java" contentType="text/html; charset=EUC-KR"
	pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
</head>
<body>
	<%
		// Servic는 Java code만 작성되므로 View를 구현하는 jsp보다 Servlet으로 작성하여 model1에서 model2로 변경 작업
		String id = request.getParameter("id");
		String pw = request.getParameter("pw");
		String tel = request.getParameter("tel");

		// 0. lib 폴더 안에 ojdbc6.jar 파일 넣기
		// C:\oraclexe\app\oracle\product\11.2.0\server\jdbc\lib에서 WebContent\WEB-INF\lib으로 ojdc6.jar파일 이동

		// 1. 어떠한 Driver를 사용할 것인지 동적 로딩
		// 2. 해당 DBMS에 관련된 Driver 클래스 파일을 작성한다.
		Class.forName("oracle.jdbc.driver.OracleDriver"); // 오라클 드라이버의 경로 작성 : 오라클 드라이버를 사용하겠다는 선언
		// OracleDriver라는 클래스 파일 실행(대문자로 시작, 패키지는 폴더이므로 소문자로 시작)
		// jsp는 기본적으로 예외처리가 되어있어 따로 작성하지 않아도 됨

		// 3. Java Program과 DataBase를 연결하는 Connection 객체 생성
		String db_url = "jdbc:oracle:thin:@localhost:1521:xe";
		// 하단 Data Source Explorer New Oracle 더블클릭 실행 > 우클릭 Properties > DriverProperties > Connection URL 복사
		String db_id = "hr";
		String db_pw = "hr";

		Connection conn = DriverManager.getConnection(db_url, db_id, db_pw); // Connection 자동완성(Connection.sql), DriverManager 자동완성(import)

		// 4. SQL문을 작성하고 실행할 수 있는 PreparedStatement
		// PreparedStatement 객체를 Connection 객체로부터 받아온다.
		String sql = "insert into mymember values(?, ?, ?)"; // mymember 테이블로 값을 포함하는 행을 추가하는 sql문
		PreparedStatement psmt = conn.prepareStatement(sql); // conn의 prepareStatement메소드로 sql문을 받아준다.
		psmt.setString(1, id); // String id의 값을 1번 째 물을표로 대입
		psmt.setString(2, pw); // String pw의 값을 2번 째 물음표로 대입
		psmt.setString(3, tel); // String tel의 값을 3번 째 물음표로 대입
		int cnt = psmt.executeUpdate(); // psmt의 executeUpdate 메소드는 sql문장을 실행한 횟수만큼 int값을 반환

		// 5. 연결 종료 (역순)
		if (psmt != null) // 객체가 Null인 상태에서 건드리면 NullPointException 에러 발생
			psmt.close();
		if (conn != null)
			conn.close();

		if (cnt > 0) {
			response.sendRedirect("main.jsp"); // 정상적으로 sql문이 실행되었다면 main으로 페이지 이동
		} else {
			response.sendRedirect("join.jsp"); // 정상적으로 sql문이 실행되지 않았다면 join페이지로 다시 이동
		}
	%>
</body>
</html>